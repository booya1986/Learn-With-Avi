ADMIN API STRUCTURE
===================

ğŸ“ /src/app/api/admin/
â”‚
â”œâ”€â”€ ğŸ¬ youtube/
â”‚   â””â”€â”€ validate/
â”‚       â””â”€â”€ route.ts
â”‚           â””â”€â”€ POST - Validate YouTube URL & fetch metadata
â”‚
â”œâ”€â”€ ğŸ“š courses/
â”‚   â”œâ”€â”€ route.ts
â”‚   â”‚   â”œâ”€â”€ GET  - List all courses (with filters)
â”‚   â”‚   â””â”€â”€ POST - Create new course
â”‚   â”‚
â”‚   â””â”€â”€ [id]/
â”‚       â”œâ”€â”€ route.ts
â”‚       â”‚   â”œâ”€â”€ GET    - Get single course with videos
â”‚       â”‚   â”œâ”€â”€ PUT    - Update course
â”‚       â”‚   â””â”€â”€ DELETE - Delete course (cascade)
â”‚       â”‚
â”‚       â””â”€â”€ reorder/
â”‚           â””â”€â”€ route.ts
â”‚               â””â”€â”€ POST - Reorder videos in course
â”‚
â”œâ”€â”€ ğŸ¥ videos/
â”‚   â”œâ”€â”€ route.ts
â”‚   â”‚   â”œâ”€â”€ GET  - List all videos (with filters)
â”‚   â”‚   â””â”€â”€ POST - Create new video with chapters
â”‚   â”‚
â”‚   â””â”€â”€ [id]/
â”‚       â””â”€â”€ route.ts
â”‚           â”œâ”€â”€ GET    - Get single video with chapters
â”‚           â”œâ”€â”€ PUT    - Update video (replace chapters)
â”‚           â””â”€â”€ DELETE - Delete video (cascade)
â”‚
â””â”€â”€ ğŸ“ transcripts/
    â””â”€â”€ route.ts
        â”œâ”€â”€ POST - Create transcript with chunks
        â””â”€â”€ PUT  - Update transcript (replace chunks)


DATABASE RELATIONSHIPS
======================

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Course    â”‚â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚    Video    â”‚â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚   Chapter   â”‚
â”‚             â”‚ 1    âˆ  â”‚             â”‚ 1    âˆ  â”‚             â”‚
â”‚  id         â”‚         â”‚  id         â”‚         â”‚  id         â”‚
â”‚  title      â”‚         â”‚  youtubeId  â”‚         â”‚  title      â”‚
â”‚  difficulty â”‚         â”‚  title      â”‚         â”‚  startTime  â”‚
â”‚  published  â”‚         â”‚  duration   â”‚         â”‚  endTime    â”‚
â”‚  order      â”‚         â”‚  published  â”‚         â”‚  order      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚  order      â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚  courseId   â”‚
                        â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                               â”‚ 1
                               â”‚
                               â”‚ 0..1
                        â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                        â”‚ Transcript  â”‚â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚ TranscriptChunk â”‚
                        â”‚             â”‚ 1    âˆ  â”‚                 â”‚
                        â”‚  id         â”‚         â”‚  id             â”‚
                        â”‚  source     â”‚         â”‚  text           â”‚
                        â”‚  language   â”‚         â”‚  startTime      â”‚
                        â”‚  videoId    â”‚         â”‚  endTime        â”‚
                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚  order          â”‚
                                                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


API WORKFLOW EXAMPLES
=====================

1. CREATE FULL COURSE WITH VIDEO
   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   
   Step 1: Validate YouTube URL
   POST /api/admin/youtube/validate
   Body: { "url": "https://youtube.com/watch?v=abc123" }
   â†“
   Returns: { "valid": true, "metadata": {...} }
   
   Step 2: Create Course
   POST /api/admin/courses
   Body: { "title": "Python Basics", "difficulty": "beginner" }
   â†“
   Returns: { "id": "course-123", ... }
   
   Step 3: Create Video
   POST /api/admin/videos
   Body: {
     "youtubeId": "abc123",
     "title": "...",
     "duration": 3600,
     "courseId": "course-123",
     "chapters": [...]
   }
   â†“
   Returns: { "id": "video-456", ... }
   
   Step 4: Add Transcript
   POST /api/admin/transcripts
   Body: {
     "videoId": "video-456",
     "chunks": [...]
   }
   â†“
   Returns: { "id": "transcript-789", ... }


2. UPDATE VIDEO ORDER IN COURSE
   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   
   Step 1: Get Course with Videos
   GET /api/admin/courses/course-123
   â†“
   Returns: { "id": "course-123", "videos": [...] }
   
   Step 2: Reorder Videos
   POST /api/admin/courses/course-123/reorder
   Body: { "videoIds": ["video-3", "video-1", "video-2"] }
   â†“
   Returns: { "success": true, "updatedCount": 3 }


3. SEARCH AND FILTER
   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   
   Search Published Courses
   GET /api/admin/courses?search=python&published=true
   â†“
   Returns: [{ "id": "...", "title": "Python...", ... }]
   
   Get Videos for Specific Course
   GET /api/admin/videos?courseId=course-123
   â†“
   Returns: [{ "id": "...", "title": "...", "course": {...} }]


AUTHENTICATION FLOW
===================

1. User â†’ Login Page (/admin/login)
   â†“
2. Submit Credentials â†’ NextAuth
   â†“
3. NextAuth â†’ Validates with Database
   â†“
4. Creates Session â†’ HTTP-only Cookie
   â†“
5. All API Requests â†’ Include Cookie Automatically
   â†“
6. API Routes â†’ Validate Session with getServerSession()


VALIDATION LAYERS
=================

Request
  â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. Authentication Check â”‚ â† getServerSession()
â”‚    (401 if no session)  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. Zod Schema           â”‚ â† Request body validation
â”‚    Validation           â”‚   (400 if invalid)
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3. Business Logic       â”‚ â† Check resource exists
â”‚    Validation           â”‚   (404 if not found)
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 4. Database Operation   â”‚ â† Prisma transaction
â”‚    (with transaction)   â”‚   (500 if error)
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“
Response (200/201)


ERROR HANDLING
==============

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Try Block       â”‚
â”‚  â†“               â”‚
â”‚  API Logic       â”‚
â”‚  â†“               â”‚
â”‚  Success         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â†“ (on error)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Catch Block     â”‚
â”‚  â†“               â”‚
â”‚  Log Error       â”‚ â† console.error()
â”‚  â†“               â”‚
â”‚  Sanitize Error  â”‚ â† Remove sensitive data
â”‚  â†“               â”‚
â”‚  Return JSON     â”‚ â† { "error": "..." }
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


TRANSACTION EXAMPLES
====================

Create Video with Chapters:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ START TRANSACTION        â”‚
â”‚  â†“                       â”‚
â”‚  1. Create Video         â”‚ â† prisma.video.create()
â”‚  â†“                       â”‚
â”‚  2. Create Chapters      â”‚ â† prisma.chapter.createMany()
â”‚  â†“                       â”‚
â”‚  3. Fetch with Relations â”‚ â† prisma.video.findUnique()
â”‚  â†“                       â”‚
â”‚ COMMIT TRANSACTION       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“
If any step fails â†’ ROLLBACK (all or nothing)


CASCADE DELETE BEHAVIOR
========================

Delete Course
    â†“
    â””â”€â†’ Delete all Videos
            â†“
            â”œâ”€â†’ Delete all Chapters
            â””â”€â†’ Delete Transcript
                    â†“
                    â””â”€â†’ Delete all TranscriptChunks

(Defined in Prisma schema with "onDelete: Cascade")


HTTP STATUS CODES GUIDE
========================

2xx SUCCESS
  200 OK          - GET, PUT successful
  201 Created     - POST successful

4xx CLIENT ERROR
  400 Bad Request - Invalid input, validation failed
  401 Unauthorized - Not logged in
  404 Not Found   - Resource doesn't exist
  409 Conflict    - Duplicate resource (e.g., YouTube ID)

5xx SERVER ERROR
  500 Internal Server Error - Unexpected error


TESTING CHECKLIST
=================

âœ… YouTube Integration
  â–¡ Valid YouTube URL
  â–¡ Invalid YouTube URL
  â–¡ Missing API key handling

âœ… Courses
  â–¡ Create course
  â–¡ List courses
  â–¡ List with filters (search, published)
  â–¡ Get single course
  â–¡ Update course
  â–¡ Delete course (verify cascade)

âœ… Videos
  â–¡ Create video with chapters
  â–¡ Create with duplicate YouTube ID (expect 409)
  â–¡ List videos
  â–¡ List with filters (courseId, search, published)
  â–¡ Get single video
  â–¡ Update video
  â–¡ Update chapters (verify replacement)
  â–¡ Reorder videos in course
  â–¡ Delete video (verify cascade)

âœ… Transcripts
  â–¡ Create transcript with chunks
  â–¡ Create duplicate transcript (expect 409)
  â–¡ Update transcript
  â–¡ Update chunks (verify replacement)

âœ… Authentication
  â–¡ All routes return 401 without session
  â–¡ All routes work with valid session

âœ… Edge Cases
  â–¡ Update with no fields
  â–¡ Delete non-existent resource
  â–¡ Reference non-existent foreign key
  â–¡ Reorder with invalid video IDs


PERFORMANCE NOTES
=================

Optimized Queries:
  - Use `include` to eager load relations
  - Avoid N+1 queries
  - Indexes on: courseId, youtubeId, published

Transactions:
  - Multi-step operations are atomic
  - Rollback on failure

Future Enhancements:
  - Add pagination (limit/offset)
  - Add Redis caching
  - Add full-text search
  - Add rate limiting per user
