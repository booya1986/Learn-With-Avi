# LearnWithAvi Environment Variables
# Copy this file to .env.local and fill in your values
#
# SECURITY NOTES:
# - NEVER commit .env.local to version control
# - Keep API keys secure and rotate them regularly
# - Use different keys for development and production
# - All errors are sanitized to prevent key leakage in logs

# ============================================================================
# REQUIRED API KEYS
# ============================================================================

# Anthropic Claude API (REQUIRED)
# Used for: AI-powered chat responses with students
# Get your key at: https://console.anthropic.com/
# Cost optimization: Context caching enabled (75% cost reduction on repeated context)
# Rate limit: 10 requests/minute per IP
ANTHROPIC_API_KEY=sk-ant-xxxxx

# OpenAI API (REQUIRED)
# Used for: Generating embeddings for semantic search in transcripts
# Get your key at: https://platform.openai.com/api-keys
# Cost optimization: LRU cache with 1-hour TTL (30% cost reduction on duplicates)
# Model: text-embedding-3-small (1536 dimensions)
OPENAI_API_KEY=sk-xxxxx

# ============================================================================
# OPTIONAL SERVICES
# ============================================================================

# Vector Database Configuration (Optional - graceful degradation enabled)
# Options: pgvector | chroma | keyword
# - pgvector: PostgreSQL with pgvector extension (RECOMMENDED for production)
# - chroma: ChromaDB standalone server (legacy, requires separate service)
# - keyword: Keyword-only search (no vector database, uses BM25)
# Default: pgvector
VECTOR_DB=pgvector

# ChromaDB Vector Database (Optional - only if VECTOR_DB=chroma)
# Used for: Semantic search of video transcripts
# If unavailable: Automatically falls back to keyword-based search
# Default: localhost:8000
# For production: Consider using a hosted ChromaDB instance or Chroma Cloud
CHROMA_HOST=localhost
CHROMA_PORT=8000

# Redis Cache (Optional - recommended for production)
# Used for: Distributed caching across multiple server instances
# Benefits: Share embeddings cache, rate limiting, and session data
# If unavailable: Falls back to in-memory caching (works but not shared across instances)
# Format: redis://host:port or rediss://host:port (TLS)
# For production: Use managed Redis (Railway, Upstash, Redis Cloud)
# Default: localhost:6379
REDIS_URL=redis://localhost:6379
# Alternative: Set individual parameters
# REDIS_HOST=localhost
# REDIS_PORT=6379
# REDIS_PASSWORD=
# REDIS_DB=0

# ElevenLabs Text-to-Speech (Optional)
# Used for: High-quality AI voice synthesis for course narration
# Get your key at: https://elevenlabs.io/
# If unavailable: Automatically falls back to browser's built-in Web Speech API
# Rate limit: 5 requests/minute per IP
ELEVENLABS_API_KEY=
ELEVENLABS_VOICE_ID=

# YouTube Data API v3 (Optional)
# Used for: Importing video transcripts from YouTube
# Get your key at: https://console.cloud.google.com/apis/credentials
# If unavailable: Manual transcript upload still works
YOUTUBE_API_KEY=

# OpenAI Whisper API (Optional)
# Used for: Automatic video transcription with Hebrew language support
# Uses the same OPENAI_API_KEY as embeddings
# Model: whisper-1 (multilingual, supports 99+ languages including Hebrew)
# Cost: ~$0.006/minute of audio transcribed
# If unavailable: Use YouTube's auto-generated captions or manual transcription

# ============================================================================
# SKILLS & ADVANCED FEATURES
# ============================================================================

# Skills are optional specialized tools for development and optimization
# Located in: /skills directory
# Documentation: /docs/SKILLS_RECOMMENDATIONS.md

# RAG Pipeline Optimizer (requires ANTHROPIC_API_KEY + OPENAI_API_KEY)
# Used for: Hybrid search, semantic re-ranking, prompt caching optimization
# Scripts: hybrid_search.py, cache_optimizer.py, rerank.py
# Enable to: Improve RAG accuracy and reduce API costs by 50-90%

# Voice AI Tutor (requires OPENAI_API_KEY + ELEVENLABS_API_KEY)
# Used for: Real-time voice-to-voice tutoring with Hebrew support
# Features: Whisper STT + Claude reasoning + ElevenLabs TTS
# Enable to: Provide hands-free learning experience
# Latency target: <700ms round-trip

# Video Ingestion Pipeline (requires YOUTUBE_API_KEY + OPENAI_API_KEY)
# Used for: Automated video import with transcription and chunking
# Features: YouTube metadata extraction, Whisper transcription, semantic chunking
# Enable to: Scale content library without manual transcript creation

# ============================================================================
# APPLICATION CONFIGURATION
# ============================================================================

# Node Environment
# Options: development | production | test
NODE_ENV=development

# Next.js Configuration
# Base URL for your application (used for absolute URLs)
# Development: http://localhost:3000
# Production: https://your-domain.com
NEXT_PUBLIC_APP_URL=http://localhost:3000

# ============================================================================
# DATABASE & AUTHENTICATION
# ============================================================================

# PostgreSQL Database URL (REQUIRED)
# Format: postgresql://USER:PASSWORD@HOST:PORT/DATABASE?connection_limit=10&pool_timeout=20
# Example: postgresql://postgres:password@localhost:5432/learnwithavi
# For local development: Use Docker or local PostgreSQL installation
# For production: Use managed service like Supabase, Railway, or Neon
#
# Connection Pooling (RECOMMENDED for production):
# Add query parameters to optimize concurrent connections:
# ?connection_limit=10    - Max connections per Prisma Client instance
# &pool_timeout=20        - Max seconds to wait for available connection
# Full example: postgresql://user:pass@host:5432/db?connection_limit=10&pool_timeout=20
DATABASE_URL=postgresql://postgres:password@localhost:5432/learnwithavi

# NextAuth Secret (REQUIRED for production)
# Generate with: openssl rand -base64 32
# Used for: Encrypting JWT tokens and session cookies
# IMPORTANT: Keep this secret and use different values for dev/prod
NEXTAUTH_SECRET=your-secret-key-here-change-in-production

# NextAuth URL (REQUIRED for production)
# Base URL of your application for OAuth callbacks
# Development: http://localhost:3000
# Production: https://your-domain.com
NEXTAUTH_URL=http://localhost:3000

# ============================================================================
# MONITORING & DEBUGGING
# ============================================================================

# Sentry Error Tracking (Optional)
# Used for: Real-time error tracking, performance monitoring, and debugging
# Get your DSN at: https://sentry.io/ (create account and project)
# Features: Automatic error capture, performance monitoring, source maps
# Rate limiting: 10 errors/second (free plan)
# Documentation: https://docs.sentry.io/platforms/javascript/guides/nextjs/
NEXT_PUBLIC_SENTRY_DSN=

# Sentry Build Configuration (Optional - for source map upload)
# Used during build process to upload source maps to Sentry
# Get token at: https://sentry.io/settings/account/tokens/
SENTRY_AUTH_TOKEN=

# Sentry Organization Slug (Optional - for source map upload)
# Found in: https://sentry.io/settings/
SENTRY_ORG=

# Sentry Project Slug (Optional - for source map upload)
# Found in: https://sentry.io/settings/[org]/projects/
SENTRY_PROJECT=

# Sentry Release Version (Optional - for version tracking)
# Format: semantic versioning (e.g., 1.0.0)
# If not set: Will use current git commit hash
SENTRY_RELEASE=

# Health Check Endpoint
# Access at: /api/health
# Returns: Service status, cache statistics, API key validation
# Use for: Production monitoring, load balancer health checks

# Cache Statistics
# Embedding cache: 1000 entries, 1-hour TTL
# View stats at: /api/health endpoint
# Logs: Development mode logs cache statistics every hour

# ============================================================================
# COST ESTIMATES (per 1000 active users, 10 messages/day)
# ============================================================================
# With optimizations enabled:
# - Anthropic Claude: ~$112/month (75% savings from caching)
# - OpenAI Embeddings: ~$1.40/month (30% savings from caching)
# - ElevenLabs TTS: ~$100/month (if used)
# Total: ~$213/month
#
# Annual savings from optimizations: ~$4,068 (62% reduction)
